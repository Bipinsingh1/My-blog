{% extends "blog/base.html" %}
{% block content %}
    <div class="col-md-8">
    {% for post in posts %}
        <article class="media content-section">
          <img class="rounded-circle article-img" src="{{ post.author.profile.image.url }}">
          <div class="media-body">
            <div class="article-metadata">
              <a class="mr-2" href="{% url 'user-posts' post.author.username %}">{{ post.author }}</a>
              <small class="text-muted">{{ post.date_posted|date:"F d, Y" }}</small>
            </div>
            <h2><a class="article-title" href="{% url 'post-detail' post.id %}">{{ post.title }}</a></h2>
              <a href="{% url 'category' post.category|slugify %}">{{ post.category }}</a>
            <p class="article-content">{{ post.content|truncatechars:200|safe}}</p>
          </div>
        </article>
    {% endfor %}


    {% if is_paginated %}

      {% if page_obj.has_previous %}
        <a class="btn btn-outline-info mb-4" href="?page=1">First</a>
        <a class="btn btn-outline-info mb-4" href="?page={{ page_obj.previous_page_number }}">Previous</a>
      {% endif %}

      {% for num in page_obj.paginator.page_range %}
        {% if page_obj.number == num %}
          <a class="btn btn-info mb-4" href="?page={{ num }}">{{ num }}</a>
        {% elif num > page_obj.number|add:'-3' and num < page_obj.number|add:'3' %}
          <a class="btn btn-outline-info mb-4" href="?page={{ num }}">{{ num }}</a>
        {% endif %}
      {% endfor %}

      {% if page_obj.has_next %}
        <a class="btn btn-outline-info mb-4" href="?page={{ page_obj.next_page_number }}">Next</a>
        <a class="btn btn-outline-info mb-4" href="?page={{ page_obj.paginator.num_pages }}">Last</a>
      {% endif %}
    {% endif %}
    </div>
    <div class="col-md-4">
        <div class="content-section">
            <h3>Latest Posts</h3>
            <div class="latest-posts">
                {% if latest_post %}
                <ul class="list-group">
                {% for post in latest_post %}
                    <li class="list-group-item list-group-item-light post-item">
                        <div class="post-header" data-toggle="collapse" data-target="#post-content-{{ post.id }}" aria-expanded="false">
                            <div class="d-flex justify-content-between align-items-center">
                                <h5 class="mb-0">{{ post.title }}</h5>
                                <i class="fas fa-chevron-down toggle-icon ml-2"></i>
                            </div>
                            <small class="text-muted">{{ post.date_posted|date:'F d, Y' }}</small>
                        </div>
                        <div class="collapse mt-2" id="post-content-{{ post.id }}">
                            <div class="post-preview">
                                <p>{{ post.content|truncatechars:100|safe }}</p>
                                <a href="{% url 'post-detail' post.id %}" class="btn btn-sm btn-primary refresh-page">Read Full Post</a>
                            </div>
                        </div>
                    </li>
                {% endfor %}
                </ul>
                {% else %}
                <p class="text-muted">No recent posts available.</p>
                {% endif %}
            </div>
        </div>
        
        <div class="content-section">
            <h3 class="sidebar-heading">Categories</h3>
            <div class="sidebar-content">
                {% if cat_list %}
                <ul class="list-group category-list">
                {% for category in cat_list %}
                    <li class="list-group-item list-group-item-light post-item p-0">
                        <div class="post-header d-flex justify-content-between align-items-center p-3" data-toggle="collapse" data-target="#category-content-{{ forloop.counter }}" aria-expanded="false">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-tag mr-2"></i>
                                <h5 class="mb-0">{{ category }}</h5>
                            </div>
                            <i class="fas fa-chevron-down toggle-icon"></i>
                        </div>
                        <div class="collapse" id="category-content-{{ forloop.counter }}">
                            <div class="post-preview p-3 border-top">
                                <p class="mb-2 text-muted">Posts in this category:</p>
                                {% for post in posts %}
                                    {% if post.category == category %}
                                    <div class="category-post mb-2">
                                        <a href="{% url 'post-detail' post.id %}" class="d-block font-weight-bold">{{ post.title }}</a>
                                        <small class="text-muted"><i class="far fa-clock mr-1"></i>{{ post.date_posted|date:'F d, Y' }}</small>
                                    </div>
                                    {% endif %}
                                {% endfor %}
                                <a href="{% url 'category' category|slugify %}" class="btn btn-sm btn-primary mt-2 refresh-page">
                                    <i class="fas fa-list mr-1"></i> View All Posts
                                </a>
                            </div>
                        </div>
                    </li>
                {% endfor %}
                </ul>
                {% else %}
                <p class="text-muted">No categories available.</p>
                {% endif %}
            </div>
        </div>
    </div>

{% endblock content %}
