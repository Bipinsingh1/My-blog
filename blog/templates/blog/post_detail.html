{% extends "blog/base.html" %}
{% block title %}{{ post.title_tag }}{% endblock %}
{% block content %}
    <div class="col-md-8">
  <article class="media content-section">
    <img class="rounded-circle article-img" src="{{ object.author.profile.image.url }}">
    <div class="media-body">
      <div class="article-metadata">
        <a class="mr-2" href="{% url 'user-posts' post.author.username %}">{{ object.author }}</a>
        <small class="text-muted">{{ object.date_posted|date:"F d, Y" }}</small>
      </div>
      <h2 class="article-title">{{ object.title }}</h2>
      {% if post.image %}
          <div class="blog-image"><img src="{{ post.image.url }}" alt="{{ object.title }}"></div>
      {% endif %}
      <div class="article-content">{{ object.content|safe }}</div>
    </div>
  </article>

  {% if object.author == user %}
  <div class="mt-3 mb-4 text-left">
    <a class="btn btn-secondary mr-2" href="{% url 'post-update' object.id %}">
      <i class="fas fa-edit mr-1"></i> Update
    </a>
    <a class="btn btn-danger" href="{% url 'post-delete' object.id %}">
      <i class="fas fa-trash-alt mr-1"></i> Delete
    </a>
  </div>
  {% endif %}
  
  <div class="col-lg-12 mt-4">
    <h2 class="mb-4">Comments</h2>
      <div class="content">
        {% if not post.comments.all %}
            <div class="alert alert-light">
                <h5 class="mb-0">No comments yet. Be the first to comment!</h5>
            </div>
        {% else %}
            <div class="comment-list">
                {% for comment in post.comments.all %}
                    <div class="comment-item content-section mb-3">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">{{ comment.name }}</h5>
                            <small class="text-muted"><i class="far fa-calendar-alt mr-1"></i> {{ comment.date_posted|date:"F d, Y" }}</small>
                        </div>
                        <hr class="my-2">
                        <p class="mb-0">{{ comment.content }}</p>
                    </div>
                {% endfor %}
            </div>
        {% endif %}
      </div>
      
      <!-- Comment Form -->
      <div class="content-section mt-4 mb-4">
        <h4 class="mb-3"><i class="far fa-comment mr-2"></i>Add a Comment</h4>
        <form method="POST">
            {% csrf_token %}
            <div class="form-group">
                {% if user.is_authenticated %}
                <label for="{{ comment_form.name.id_for_label }}">Name</label>
                <input type="text" class="form-control" name="name" id="{{ comment_form.name.id_for_label }}" 
                       value="{{ user.username }}" placeholder="Your name">
                {% else %}
                <label for="{{ comment_form.name.id_for_label }}">Name</label>
                <input type="text" class="form-control" name="name" id="{{ comment_form.name.id_for_label }}" 
                       placeholder="Your name">
                {% endif %}
            </div>
            <div class="form-group">
                <label for="{{ comment_form.content.id_for_label }}">Comment</label>
                <textarea class="form-control" name="content" id="{{ comment_form.content.id_for_label }}" rows="3" placeholder="Your comment"></textarea>
            </div>
            <button type="submit" class="btn btn-primary">
                <i class="fas fa-paper-plane mr-1"></i> Post Comment
            </button>
        </form>
      </div>
  </div>
    </div>
 <div class="col-md-4">
        <div class="content-section">
            <h3 class="sidebar-heading">Latest Posts</h3>
            <div class="sidebar-content">
                {% if latest_post %}
                <ul class="list-group latest-posts-list">
                {% for post in latest_post %}
                    <li class="list-group-item list-group-item-light post-item p-0">
                        <div class="post-header d-flex justify-content-between align-items-center p-3" data-toggle="collapse" data-target="#post-content-{{ post.id }}" aria-expanded="false">
                            <div>
                                <h5 class="mb-0">{{ post.title }}</h5>
                                <small class="text-muted"><i class="far fa-clock mr-1"></i>{{ post.date_posted|date:'F d, Y' }}</small>
                            </div>
                            <i class="fas fa-chevron-down toggle-icon"></i>
                        </div>
                        <div class="collapse" id="post-content-{{ post.id }}">
                            <div class="post-preview p-3 border-top">
                                <p>{{ post.content|truncatechars:100|safe }}</p>
                                <div class="d-flex align-items-center">
                                    <span class="badge badge-light mr-2"><i class="fas fa-tag mr-1"></i>{{ post.category }}</span>
                                    <a href="{% url 'post-detail' post.id %}" class="btn btn-sm btn-primary ml-auto refresh-page">Read Full Post</a>
                                </div>
                            </div>
                        </div>
                    </li>
                {% endfor %}
                </ul>
                {% else %}
                <p class="text-muted">No recent posts available.</p>
                {% endif %}
            </div>
        </div>
        
        <div class="content-section">
            <h3 class="sidebar-heading">Categories</h3>
            <div class="sidebar-content">
                {% if cat_list %}
                <ul class="list-group category-list">
                {% for category in cat_list %}
                    <li class="list-group-item list-group-item-light post-item p-0">
                        <div class="post-header d-flex justify-content-between align-items-center p-3" data-toggle="collapse" data-target="#category-content-{{ forloop.counter }}" aria-expanded="false">
                            <div class="d-flex align-items-center">
                                <i class="fas fa-tag mr-2"></i>
                                <h5 class="mb-0">{{ category }}</h5>
                            </div>
                            <i class="fas fa-chevron-down toggle-icon"></i>
                        </div>
                        <div class="collapse" id="category-content-{{ forloop.counter }}">
                            <div class="post-preview p-3 border-top">
                                <p class="mb-2 text-muted">Browse posts in this category:</p>
                                {% for post in latest_post %}
                                    {% if post.category == category %}
                                    <div class="category-post mb-2">
                                        <a href="{% url 'post-detail' post.id %}" class="d-block font-weight-bold">{{ post.title }}</a>
                                        <small class="text-muted"><i class="far fa-clock mr-1"></i>{{ post.date_posted|date:'F d, Y' }}</small>
                                    </div>
                                    {% endif %}
                                {% endfor %}
                                <a href="{% url 'category' category|slugify %}" class="btn btn-sm btn-primary mt-2 refresh-page">
                                    <i class="fas fa-list mr-1"></i> View All Posts
                                </a>
                            </div>
                        </div>
                    </li>
                {% endfor %}
                </ul>
                {% else %}
                <p class="text-muted">No categories available.</p>
                {% endif %}
            </div>
        </div>
    </div>
</div>
{% endblock content %}
